<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jaagro.report.biz.mapper.cbs.BreedingPlanMapperExt">

    <!--          自动生成扩展XML author: generator on 2019/2/21                 -->
    <select id="listBreedingPlanInfoByBatchType" resultType="com.jaagro.report.api.dto.finance.BreedingPlanInfoDo"
            parameterType="java.lang.Integer">
            select distinct bp.batch_no,bp.plan_chicken_quantity,bc.babychick_price babyChickPrice ,bc.contract_date
            from breeding_plan bp inner join purchase_order po on (bp.id=po.plan_id)
            inner join batch_contract bc on (bp.id=bc.plan_id)
            where po.purchase_order_status in (1) and bp.plan_status in (2) and bp.enable=1 and
            bp.customer_id=#{customerId}
            union
            select distinct bp.batch_no,bp.plan_chicken_quantity,bc.babychick_price babyChickPrice ,bc.contract_date
            from breeding_plan bp
            inner join batch_contract bc on (bp.id=bc.plan_id)
            where bp.plan_status in (1) and bp.enable=1
            and bp.customer_id=#{customerId}
    </select>
    <select id="listBreedingPlanInfoByPurchaseOrderType"
            resultType="com.jaagro.report.api.dto.finance.BreedingPlanInfoDo"
            parameterType="java.lang.Integer">
            select distinct bp.batch_no,bp.plan_chicken_quantity,bc.babychick_price babyChickPrice ,bc.contract_date
            from breeding_plan bp inner join purchase_order po on (bp.id=po.plan_id)
            inner join batch_contract bc on (bp.id=bc.plan_id)
            left JOIN loan_apply_record lar on (bp.id=lar.plan_id)
            where po.purchase_order_status in (2) and bp.plan_status in (2,3,4) and bp.enable=1 and
            lar.id is null and bp.customer_id=#{customerId}
    </select>
    <select id="getBreedingPlanInfo" resultType="com.jaagro.report.api.dto.finance.BreedingPlanDetailsDo"
            parameterType="com.jaagro.report.api.dto.finance.BreedingPlanInfoCriteria">
         select distinct bp.batch_no batchNo,bp.plan_chicken_quantity planChickenQuantity,bc.contract_date contractDate,po.id purchaseOrderId,
         po.purchase_no purchaseNo,po.product_type productType,po.total_price totalPrice,po.create_time purchaseTime
         from breeding_plan bp inner join purchase_order po on (bp.id=po.plan_id)
         inner join batch_contract bc on (bp.id=bc.plan_id) where bp.batch_no=#{batchNo}
    </select>
</mapper>